function ShowImagePreview(n){if(n.files&&n.files[0]){var t=new FileReader;t.onload=function(n){$("#imgCandidate").prop("src",n.target.result)};t.readAsDataURL(n.files[0])}}$(document).ready(function(){function c(){let r=t.answers.findIndex(n=>n.questionId===f),u=$("div#eqMain").find('input[name="option"]:checked').val()||null;if(!u){r>=0&&t.answers.splice(r,1);return}let n={examId:i.examId,questionId:f,choiceId:u,correctChoiceId:i.questions.find(n=>n.id==f)?.correctChoiceId};n.isCorrect=!!n.choiceId&&n.choiceId==n.correctChoiceId;r>=0?t.answers[r]=n:t.answers.push(n)}function d(){t={answers:[],isEnded:!1};a(!1);s(0);et(i.duration||0)}function g(){t.isEnded=!0;a(!0);nt();i.totalCount>0&&s(0);u();p()}function rt(){t.isEnded=!t.isEnded;s(h)}function l(n){c();n=n%i.totalCount;n<=i.totalCount-1&&s(n)}function nt(){$qnaArea=$("div#eqMain").find('[name^="eq"]').empty()}function s(n){if(n<0||n>=i.totalCount){w(null,`Index out of range (${n}). Cannot select the question.`);return}let r=i.questions[n];h=n;f=r.id;nt();let u=$("div#eqMain");if(u.find('[name="eqExamTile"]').html(i.name),u.find('[name="eqCounter"]').html(`(${n+1} of ${i.totalCount})`),t.isEnded){let n=t.answers.reduce((n,t)=>t.isCorrect?++n:n,0),r=t.answers.reduce((n,t)=>t.isCorrect?n:++n,0),f=i.questions.length-n-r;u.find('[name="eqExamSessionStats"]').html(`<span class='correctChoice'>${n} correct answer(s)</span><br/>`+`<span class='wrongChoice'>${r} wrong answer(s)</span><br/>`+`<span class=''><b>${f} not answered</b></span>`)}u.find('[name="eqQuestion"]').html(`${r.code||n+1}: ${r.statement}`);!r.imageUri||u.find('[name="eqQuestionImage"]').html(`<img src="${r.imageUri.charAt(0)==="~"?r.imageUri.slice(1):r.imageUri}" class="" style="max-width:100%" alt="Immagine">`);let o=t.answers.find(n=>n.questionId===f),e="<div style='padding: 5px;'>";for(let n in r.choices.sort((n,t)=>n.position-t.position)){let i=r.choices[n],u=i.id==(o?.choiceId??0)?"checked":"",f=t.isEnded?"disabled readonly":"",s=f&&u&&!i.isCorrect?"wrongChoice":f&&!u&&i.isCorrect?"correctChoiceHighlighted":f&&u&&i.isCorrect?"correctChoice":"";e+=`<div class='${s}'><label class=''><input class='w3-radio' type='radio' name='option' value='${i.id}' ${u} ${f}> ${i.statement}</label></div>`}e+="<\/div>";u.find('[name="eqChoices"]').append(e);$("#eqMain button.w3-left").prop("disabled",n<=0);$("#eqMain button.w3-right").prop("disabled",n+1>=i.totalCount)}function a(n){$("#ddlExam").prop("disabled",!n);$("#btnStart").prop("disabled",!n);$("#btnSave").prop("disabled",!n)}function ut(n){a(!1);$.get("/api/Exam/",{ExamId:n},n=>{try{ft(n.id);d()}catch(t){g();u();p()}}).fail((n,t)=>{a(!0);let i=n.responseJSON||{error:"Server error",exception:n.responseText};i.exception&&console.error(i.exception|i.error);w(errorJsonm,t,n.status)})}function ft(n){$.get("/api/PrepareExamSession",{examId:n,isRecursive:!0,isRandom:!0,maxResultCount:20},n=>{i=n,t={candidateId:$("#eqCandidateId").text(),examId:n.examId,answers:[]},s(0)}).fail(function(n,t){let i=n.responseJSON||{error:"Server error",exception:n.responseText};i.exception&&console.error(i.exception|i.error);w(i,t,n.status)})}function et(n){let t=new Date((new Date).getTime()+n*6e4);tt(t)}function ot(){let n=document.getElementById("timer").innerHTML,t=6;n=n.substring(t);n=document.getElementById("timer").innerHTML.substr(6).trim();let i=st(new Date,n);tt(i)}function u(){!e||clearInterval(e);e=null}function tt(n){u();e=setInterval(()=>{let i=(new Date).getTime(),t=n.getTime()-i,r=Math.floor(t%864e5/36e5),f=Math.floor(t%36e5/6e4),e=Math.floor(t%6e4/1e3);document.getElementById("timer").innerHTML="Time : "+r+":"+f+":"+e;t<0&&(u(),document.getElementById("timer").innerHTML="Time : 00:00:00")},1e3)}function st(n,t){var i=""+(n.getMonth()+1),r=""+n.getDate(),u=n.getFullYear();return i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),new Date(`${u}-${i}-${r}T${t}`)}function p(){!n||n.stop();!k||(k.srcObject=null)}function ht(n){var t=new FormData;t.append("video-blob",n);$.ajax({type:"POST",url:"/Home/SaveRecoredFile",data:t,cache:!1,contentType:!1,processData:!1,success:function(n){n&&console.log("Success")},error:function(n){console.log(n)}})}function w(n,t,i){$.alert({icon:"fa fa-error",type:"red",title:n?.error||"Error",content:"Error: "+t+" ("+n?.error+")<br/>Status: "+i,boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})}var i={},t={},f=null,h=-1,v=null,b=null,r=null,e=null,k=document.querySelector("#gum");$("#ddlExam").prop("disabled",!1);$("#btnStart").prop("disabled",!1);$("#btnSubmit").prop("disabled",!1);$("#eqMain button.w3-left").prop("disabled",!0);$("#eqMain button.w3-right").prop("disabled",!0);$("#eqReport").children().prop("disabled",!0);$("#eqReport a").removeAttr("href");$("#eqReport i").addClass("w3-opacity-max");$("#eqScore").children().prop("disabled",!0);var n,y=[],o=null,it="video/webm";$.ajax({type:"GET",url:"/api/Exams",data:"{}",success:function(n){var i='<option value="">--- Please Select ---<\/option>';let t=[],r=n.sort((n,t)=>n.code>t.code?1:n.code<t.code?-1:0);for(let u in r){let r=n[u],f=r.name.trim().substring(0,50);f.length<r.name.length&&(f=f.split(" ").slice(0,-1).join(" ")+"...");r.ancestorId?t.length==0&&t.push("&nbsp;&nbsp;&nbsp;"):t=[];i+=`<option value="${r.id}">${t.join("")} + ${f}</option>`}$("#ddlExam").html(i)}});$("#btnStart").click(function(){$("#ddlExam").val()?ut($("#ddlExam").val()):$.alert({icon:"fa fa-warning",type:"orange",title:"Select Skill",content:"Please select your skill !",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})});$("#btnMoveToStart").click(function(){l(0)});$("#btnPrev").click(function(){l(h-1)});$("#btnNext").click(function(){l(h+1)});$("#btnMoveToEnd").click(function(){l(i.totalCount-1)});$("#btnSave").click(function(){c()});$("#btnShowHideSession").click(()=>{c(),rt(),$("#btnShowHideSession").html(t.isEnded?"Hide solutions":"Show solutions")});$("#btnEndSession").click(()=>{g()});$("#btnRestartSession").click(()=>{d()});$("#btnSubmit").click(function(){$.confirm({icon:"fa fa-warning",title:"Submit Quiz",content:"Are you sure you want to submit the quiz?",type:"orange",closeIcon:!0,closeIconClass:"fa fa-close",boxWidth:"40%",useBootstrap:!1,buttons:{Submit:{text:"Submit",btnClass:"btn-red",action:function(){c();$.post("/api/Score/",{objRequest:t},function(n){n>0?(u(),p(),$("#btnSubmit").prop("disabled",!0),$("#eqReport").children().prop("disabled",!1),$("#eqReport a").attr("href","/Score/Result"),$("#eqReport i").removeClass("w3-opacity-max"),$.alert({type:"green",title:"Success !",content:"Please check the score.",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})):($("#btnSubmit").prop("disabled",!1),$("#eqReport").children().prop("disabled",!0),$("#eqReport a").removeAttr("href"),$("#eqReport i").addClass("w3-opacity-max"),$.alert({type:"red",title:"Error !",content:"Please try again.",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"}))})}},Cancel:function(){$(this).remove()}}})});$(".btnScore").click(function(){var n={ExamId:$(this).closest("tr").find("td:eq(2)").text(),CandidateId:$("#hdnCandidateId").val(),SessionId:$(this).closest("tr").find("td:eq(1)").text()};v=$(this).closest("tr").find("td:eq(4)").text();b=$(this).closest("tr").find("td:eq(6)").text();$.post("/api/Report/",{argRpt:n},function(n){r=n;$("div#eqScore h3").html(n[0].exam+" Test");$("div#eqScore .w3-container p:eq(0)").html("<strong>Candidate ID:<\/strong> "+n[0].candidateID);$("div#eqScore .w3-container h5").html(n[0].message);$("div#eqScore .w3-container span").html("<strong>Date:<\/strong> "+n[0].date);b=="1"?$("#eqScore").children().prop("disabled",!1):(v=null,r=null,$("#eqScore").children().prop("disabled",!0))})});$("#btnReport").click(function(){var n={ExamId:r[0].examId,CandidateId:$("#hdnCandidateId").val(),SessionId:r[0].sessionID,Exam:r[0].exam,Date:r[0].date,Score:v};$.post("/api/CreatePDF/",{argPDFRpt:n},function(n){(n.isSuccess=!0)&&window.open(n.path,"_blank")})});$("#chooseFile").change(function(){var n=$("#chooseFile")[0].files[0].name;$("#noFile").text(n)});$("#btnStopContinueTimer").click(function(){i&&(e?(u(),$("#btnStopContinueTimer").html("Continue timer")):(ot(),$("#btnStopContinueTimer").html("Pause timer")))})});