function ShowImagePreview(n){if(n.files&&n.files[0]){var t=new FileReader;t.onload=function(n){$("#imgCandidate").prop("src",n.target.result)};t.readAsDataURL(n.files[0])}}$(document).ready(function(){function b(){i.answers=[];i.isEnded=!1;h(!1);s(0);it(t.duration||0)}function k(){i.isEnded=!0;h(!0);s(0);u();v()}function s(n){if(n<0||n>=t.totalCount){y(null,`Index out of range (${n}). Cannot select the question.`);return}let r=t.questions[n];if(c=n,f=r.id,$("div#eqMain p").empty(),$("#eqCount").html(`(${n+1} of ${t.totalCount})`),$("div#eqMain h3").html(t.name),i.isEnded){let n=i.answers.reduce((n,t)=>t.isCorrect?++n:n,0),r=i.answers.reduce((n,t)=>t.isCorrect?n:++n,0),u=t.questions.length-n-r;$("div#examSessionResults").html(`<span class='correctChoice'>${n} correct answer(s)</span><br/>`+`<span class='wrongChoice'>${r} wrong answer(s)</span><br/>`+`<span class=''><b>${u} not answered</b></span>`)}else $("div#examSessionResults").empty();$("div#eqMain h4").html(`${r.code||n+1}: ${r.statement}`);let e=i.answers.find(n=>n.questionId===f),u="<div style='padding: 5px;' id='eqOption'>";for(let n in r.choices.sort((n,t)=>n.position-t.position)){let t=r.choices[n],f=t.id==(e?.choiceId??0)?"checked":"",o=i.isEnded?"disabled readonly":"",s=o&&f&&!t.isCorrect?"wrongChoice":o&&!f&&t.isCorrect?"correctChoiceHighlighted":o&&f&&t.isCorrect?"correctChoice":"";u+=`<div class='${s}'><label class=''><input class='w3-radio' type='radio' name='option' value='${t.id}' ${f} ${o}> ${t.statement}</label></div>`}u+="<\/div>";$("div#eqMain p").append(u);$("#eqMain button.w3-left").prop("disabled",n<=0);$("#eqMain button.w3-right").prop("disabled",n+1>=t.totalCount)}function h(n){$("#ddlExam").prop("disabled",!n);$("#btnStart").prop("disabled",!n);$("#btnSave").prop("disabled",!n)}function nt(n){h(!1);$.get("/api/Exam/",{ExamId:n},n=>{try{tt(n.id);b()}catch(t){k();u();v()}}).fail((n,t)=>{h(!0);let i=n.responseJSON||{error:"Server error",exception:n.responseText};i.exception&&console.error(i.exception|i.error);y(errorJsonm,t,n.status)})}function tt(n){$.get("/api/PrepareExamSession",{examId:n,isRecursive:!0,isRandom:!0,maxResultCount:50},n=>{t=n,i={candidateId:$("#eqCandidateId").text(),examId:n.examId,answers:[]},s(0)}).fail(function(n,t){let i=n.responseJSON||{error:"Server error",exception:n.responseText};i.exception&&console.error(i.exception|i.error);y(i,t,n.status)})}function it(n){let t=new Date((new Date).getTime()+n*6e4);d(t)}function rt(){let n=document.getElementById("timer").innerHTML,t=6;n=n.substring(t);n=document.getElementById("timer").innerHTML.substr(6).trim();let i=ut(new Date,n);d(i)}function u(){!e||clearInterval(e);e=null}function d(n){u();e=setInterval(()=>{let i=(new Date).getTime(),t=n.getTime()-i,r=Math.floor(t%864e5/36e5),f=Math.floor(t%36e5/6e4),e=Math.floor(t%6e4/1e3);document.getElementById("timer").innerHTML="Time : "+r+":"+f+":"+e;t<0&&(u(),document.getElementById("timer").innerHTML="Time : 00:00:00")},1e3)}function ut(n,t){var i=""+(n.getMonth()+1),r=""+n.getDate(),u=n.getFullYear();return i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),new Date(`${u}-${i}-${r}T${t}`)}function v(){!n||n.stop();w||(w.srcObject=null)}function ft(n){var t=new FormData;t.append("video-blob",n);$.ajax({type:"POST",url:"/Home/SaveRecoredFile",data:t,cache:!1,contentType:!1,processData:!1,success:function(n){n&&console.log("Success")},error:function(n){console.log(n)}})}function y(n,t,i){$.alert({icon:"fa fa-error",type:"red",title:n?.error||"Error",content:"Error: "+t+" ("+n?.error+")<br/>Status: "+i,boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})}var t=null,i=null,f=null,c=-1,l=null,p=null,r=null,e=null,w=document.querySelector("#gum");$("#ddlExam").prop("disabled",!1);$("#btnStart").prop("disabled",!1);$("#btnSubmit").prop("disabled",!1);$("#btnSave").prop("disabled",!0);$("#eqMain button.w3-left").prop("disabled",!0);$("#eqMain button.w3-right").prop("disabled",!0);$("#eqReport").children().prop("disabled",!0);$("#eqReport a").removeAttr("href");$("#eqReport i").addClass("w3-opacity-max");$("#eqScore").children().prop("disabled",!0);var n,a=[],o=null,g="video/webm";$.ajax({type:"GET",url:"/api/Exams",data:"{}",success:function(n){var i='<option value="">--- Please Select ---<\/option>';let t=[],r=n.sort((n,t)=>n.code>t.code?1:n.code<t.code?-1:0);for(let u in r){let r=n[u],f=r.name.trim().substring(0,50);f.length<r.name.length&&(f=f.split(" ").slice(0,-1).join(" ")+"...");r.ancestorId?t.length==0&&t.push("&nbsp;&nbsp;&nbsp;"):t=[];i+=`<option value="${r.id}">${t.join("")} + ${f}</option>`}$("#ddlExam").html(i)}});$("#btnStart").click(function(){$("#ddlExam").val()?nt($("#ddlExam").val()):$.alert({icon:"fa fa-warning",type:"orange",title:"Select Skill",content:"Please select your skill !",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})});$("#btnPrev").click(function(){let n=(c-1)%t.totalCount;n<=t.totalCount-1&&($("#btnSave").click(),s(n))});$("#btnNext").click(function(){let n=(c+1)%t.totalCount;n<=t.totalCount-1&&($("#btnSave").click(),s(n))});$("#btnSave").click(function(){let n={examId:t.examId,questionId:f,choiceId:$('input[name="option"]:checked').val()||null,correctChoiceId:t.questions.find(n=>n.id==f)?.correctChoiceId};n.isCorrect=!!n.choiceId&&n.choiceId==n.correctChoiceId;let r=i.answers.findIndex(n=>n.questionId===f);r>=0?i.answers[r]=n:i.answers.push(n)});$("#btnRestartSession").click(()=>{b()});$("#btnStopSession").click(()=>{k()});$("#btnSubmit").click(function(){$.confirm({icon:"fa fa-warning",title:"Submit Quiz",content:"Are you sure you want to submit the quiz?",type:"orange",closeIcon:!0,closeIconClass:"fa fa-close",boxWidth:"40%",useBootstrap:!1,buttons:{Submit:{text:"Submit",btnClass:"btn-red",action:function(){$("#btnSave").click();$.post("/api/Score/",{objRequest:i},function(n){n>0?(u(),v(),$("#btnSubmit").prop("disabled",!0),$("#eqReport").children().prop("disabled",!1),$("#eqReport a").attr("href","/Score/Result"),$("#eqReport i").removeClass("w3-opacity-max"),$.alert({type:"green",title:"Success !",content:"Please check the score.",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})):($("#btnSubmit").prop("disabled",!1),$("#eqReport").children().prop("disabled",!0),$("#eqReport a").removeAttr("href"),$("#eqReport i").addClass("w3-opacity-max"),$.alert({type:"red",title:"Error !",content:"Please try again.",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"}))})}},Cancel:function(){$(this).remove()}}})});$(".btnScore").click(function(){var n={ExamId:$(this).closest("tr").find("td:eq(2)").text(),CandidateId:$("#hdnCandidateId").val(),SessionId:$(this).closest("tr").find("td:eq(1)").text()};l=$(this).closest("tr").find("td:eq(4)").text();p=$(this).closest("tr").find("td:eq(6)").text();$.post("/api/Report/",{argRpt:n},function(n){r=n;$("div#eqScore h3").html(n[0].exam+" Test");$("div#eqScore .w3-container p:eq(0)").html("<strong>Candidate ID:<\/strong> "+n[0].candidateID);$("div#eqScore .w3-container h5").html(n[0].message);$("div#eqScore .w3-container span").html("<strong>Date:<\/strong> "+n[0].date);p=="1"?$("#eqScore").children().prop("disabled",!1):(l=null,r=null,$("#eqScore").children().prop("disabled",!0))})});$("#btnReport").click(function(){var n={ExamId:r[0].examId,CandidateId:$("#hdnCandidateId").val(),SessionId:r[0].sessionID,Exam:r[0].exam,Date:r[0].date,Score:l};$.post("/api/CreatePDF/",{argPDFRpt:n},function(n){(n.isSuccess=!0)&&window.open(n.path,"_blank")})});$("#chooseFile").change(function(){var n=$("#chooseFile")[0].files[0].name;$("#noFile").text(n)});$("#btnStopContinueTimer").click(function(){t&&(e?(u(),$("#btnStopContinueTimer").html("Continue timer")):(rt(),$("#btnStopContinueTimer").html("Pause timer")))})});