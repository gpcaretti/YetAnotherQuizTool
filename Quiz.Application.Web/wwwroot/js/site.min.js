function ShowImagePreview(n){if(n.files&&n.files[0]){var t=new FileReader;t.onload=function(n){$("#imgCandidate").prop("src",n.target.result)};t.readAsDataURL(n.files[0])}}$(document).ready(function(){function it(){$.post("/api/Score/",t,function(n){n>0?(o(),g(),$("#btnSubmit").prop("disabled",!0),$("#eqReport").children().prop("disabled",!1),$("#eqReport a").attr("href","/Score/Result"),$("#eqReport i").removeClass("w3-opacity-max"),$.alert({type:"green",title:"Success !",content:"Please check the score.",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})):($("#btnSubmit").prop("disabled",!1),$("#eqReport").children().prop("disabled",!0),$("#eqReport a").removeAttr("href"),$("#eqReport i").addClass("w3-opacity-max"),$.alert({type:"red",title:"Error !",content:"Please try again.",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"}))})}function v(){let r=t.answers.findIndex(n=>n.questionId===u),f=$("div#eqMain").find('input[name="option"]:checked').val()||null;if(!f){r>=0&&t.answers.splice(r,1);return}let i={questionId:u,userChoiceId:f,correctChoiceId:n.questions.find(n=>n.id==u)?.correctChoiceId};i.isCorrect=!!i.userChoiceId&&i.userChoiceId==i.correctChoiceId;r>=0?t.answers[r]=i:t.answers.push(i)}function b(){t={examId:n.examId,isEnded:!1,answers:[]};y();c(0);et(n.duration||0)}function rt(){t.isEnded=!t.isEnded;c(s)}function ut(){t.isEnded=!0;y();k();n.totalCount>0&&c(0);o();g()}function h(t){v();t=t%n.totalCount;t<=n.totalCount-1&&c(t)}function k(){$qnaArea=$("div#eqMain").find('[name^="eq"]').empty()}function c(i){if(i<0||i>=n.totalCount){nt(null,`Index out of range (${i}). Cannot select the question.`);return}let r=n.questions[i];s=i;u=r.id;k();let f=$("div#eqMain");if(f.find('[name="eqExamTile"]').html(n.name),f.find('[name="eqCounter"]').html(`(${i+1} of ${n.totalCount})`),t.isEnded){let i=t.answers.reduce((n,t)=>t.isCorrect?++n:n,0),r=t.answers.reduce((n,t)=>t.isCorrect?n:++n,0),u=n.questions.length-i-r;f.find('[name="eqExamSessionStats"]').html(`<span class='correctChoice'>${i} correct answer(s)</span><br/>`+`<span class='wrongChoice'>${r} wrong answer(s)</span><br/>`+`<span class=''><b>${u} not answered</b></span>`)}f.find('[name="eqQuestion"]').html(`${r.code||i+1}: ${r.statement}`);!r.imageUri||f.find('[name="eqQuestionImage"]').html(`<img src="${r.imageUri.charAt(0)==="~"?r.imageUri.slice(1):r.imageUri}" class="" style="max-width:100%" alt="Immagine">`);let o=t.answers.find(n=>n.questionId===u),e="<div style='padding: 5px;'>";for(let n in r.choices.sort((n,t)=>n.position-t.position)){let i=r.choices[n],u=i.id==(o?.userChoiceId??0)?"checked":"",f=t.isEnded?"disabled readonly":"",s=f&&u&&!i.isCorrect?"wrongChoice":f&&!u&&i.isCorrect?"correctChoiceHighlighted":f&&u&&i.isCorrect?"correctChoice":"";e+=`<div class='${s}'><label class=''><input class='w3-radio' type='radio' name='option' value='${i.id}' ${u} ${f}> ${i.statement}</label></div>`}e+="<\/div>";f.find('[name="eqChoices"]').append(e);$("#eqMain button.w3-left").prop("disabled",i<=0);$("#eqMain button.w3-right").prop("disabled",i+1>=n.totalCount)}function y(i){i==null&&(i=t.isEnded);$("#ddlExam").prop("disabled",!i);$("#btnStart").prop("disabled",!i);$("#btnShowHideSession").prop("disabled",i);$("#btnEndSession").prop("disabled",i);$("#btnRestartSession").prop("disabled",n.totalCount<=0);$("#btnShowHideSession").html(i?"Hide solutions":"Show solutions");$("#eqMain button.w3-left").prop("disabled",n.totalCount<=0);$("#eqMain button.w3-right").prop("disabled",n.totalCount<=0)}function ft(i){$.get("/api/PrepareExamSession",i,i=>{n=i,t={candidateId:$("#eqCandidateId").text(),examId:i.examId,answers:[]},b()}).fail(function(n,t){let i=n.responseJSON||{error:"Server error",exception:n.responseText};i.exception&&console.error(i.exception|i.error);nt(i,t,n.status)})}function et(n){let t=new Date((new Date).getTime()+n*6e4);d(t)}function ot(){let n=document.getElementById("timer").innerHTML,t=6;n=n.substring(t);n=document.getElementById("timer").innerHTML.substr(6).trim();let i=st(new Date,n);d(i)}function o(){!f||clearInterval(f);f=null}function d(n){o();f=setInterval(()=>{let i=(new Date).getTime(),t=n.getTime()-i,r=Math.floor(t%864e5/36e5),u=Math.floor(t%36e5/6e4),f=Math.floor(t%6e4/1e3);document.getElementById("timer").innerHTML="Time : "+r+":"+u+":"+f;t<0&&(o(),document.getElementById("timer").innerHTML="Time : 00:00:00")},1e3)}function st(n,t){var i=""+(n.getMonth()+1),r=""+n.getDate(),u=n.getFullYear();return i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),new Date(`${u}-${i}-${r}T${t}`)}function g(){!i||i.stop();!w||(w.srcObject=null)}function ht(n){var t=new FormData;t.append("video-blob",n);$.ajax({type:"POST",url:"/Home/SaveRecoredFile",data:t,cache:!1,contentType:!1,processData:!1,success:function(n){n&&console.log("Success")},error:function(n){console.log(n)}})}function nt(n,t,i){$.alert({icon:"fa fa-error",type:"red",title:n?.error||"Error",content:"Error: "+t+" ("+n?.error+")<br/>Status: "+i,boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})}var n={examId:0,name:"",duration:0,totalCount:0,questions:[]},t={examId:0,isEnded:!0,answers:[]},u=null,s=-1,l=null,p=null,r=null,f=null,w=document.querySelector("#gum");y();$("#eqReport").children().prop("disabled",!0);$("#eqReport a").removeAttr("href");$("#eqReport i").addClass("w3-opacity-max");$("#eqScore").children().prop("disabled",!0);var i,a=[],e=null,tt="video/webm";$.ajax({type:"GET",url:"/api/Exams",data:"{}",success:function(n){var i='<option value="">--- Please Select ---<\/option>';let t=[],r=n.sort((n,t)=>n.code>t.code?1:n.code<t.code?-1:0);for(let u in r){let r=n[u],f=r.name.trim().substring(0,50);f.length<r.name.length&&(f=f.split(" ").slice(0,-1).join(" ")+"...");r.ancestorId?t.length==0&&t.push("&nbsp;&nbsp;&nbsp;"):t=[];i+=`<option value="${r.id}">${t.join("")} + ${f}</option>`}$("#ddlExam").html(i)}});$("#btnStart").click(function(){if(!$("#ddlExam").val())$.alert({icon:"fa fa-warning",type:"orange",title:"Select Skill",content:"Please select your skill !",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"});else{let n={examId:$("#ddlExam").val(),isRandom:$("#cbRandomStart").is(":checked"),isRecursive:!0,maxResultCount:$("#ddlNumOfQuestions").val()};ft(n)}});$("#btnMoveToStart").click(function(){h(0)});$("#btnPrev").click(function(){h(s-1)});$("#btnNext").click(function(){h(s+1)});$("#btnMoveToEnd").click(function(){h(n.totalCount-1)});$("#btnShowHideSession").click(()=>{v(),rt(),$("#btnShowHideSession").html(t.isEnded?"Hide solutions":"Show solutions")});$("#btnEndSession").click(()=>{ut(),$.confirm({icon:"fa fa-warning",title:"Test ended",content:"Do you want to save the quiz session?",type:"orange",closeIcon:!0,closeIconClass:"fa fa-close",boxWidth:"40%",useBootstrap:!1,buttons:{Submit:{text:"Submit",btnClass:"btn-red",action:function(){v();it()}},Cancel:function(){$(this).remove()}}})});$("#btnRestartSession").click(()=>{b()});$(".btnScore").click(function(){var n={ExamId:$(this).closest("tr").find("td:eq(2)").text(),CandidateId:$("#hdnCandidateId").val(),SessionId:$(this).closest("tr").find("td:eq(1)").text()};l=$(this).closest("tr").find("td:eq(4)").text();p=$(this).closest("tr").find("td:eq(6)").text();$.post("/api/Report/",{argRpt:n},function(n){r=n;$("div#eqScore h3").html(n[0].exam+" Test");$("div#eqScore .w3-container p:eq(0)").html("<strong>Candidate ID:<\/strong> "+n[0].candidateID);$("div#eqScore .w3-container h5").html(n[0].message);$("div#eqScore .w3-container span").html("<strong>Date:<\/strong> "+n[0].date);p=="1"?$("#eqScore").children().prop("disabled",!1):(l=null,r=null,$("#eqScore").children().prop("disabled",!0))})});$("#btnReport").click(function(){var n={ExamId:r[0].examId,CandidateId:$("#hdnCandidateId").val(),SessionId:r[0].sessionID,Exam:r[0].exam,Date:r[0].date,Score:l};$.post("/api/CreatePDF/",{argPDFRpt:n},function(n){(n.isSuccess=!0)&&window.open(n.path,"_blank")})});$("#chooseFile").change(function(){var n=$("#chooseFile")[0].files[0].name;$("#noFile").text(n)});$("#btnStopContinueTimer").click(function(){n&&(f?(o(),$("#btnStopContinueTimer").html("Continue timer")):(ot(),$("#btnStopContinueTimer").html("Pause timer")))})});