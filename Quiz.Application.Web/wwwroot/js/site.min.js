function ShowImagePreview(n){if(n.files&&n.files[0]){var t=new FileReader;t.onload=function(n){$("#imgCandidate").prop("src",n.target.result)};t.readAsDataURL(n.files[0])}}$(document).ready(function(){function a(n){if(n<0||n>=t.totalCount){v(null,`Index out of range (${n}). Cannot select the question.`);return}let i=t.questions[n];s=n;f=i.id;$("div#eqMain p").empty();$("#eqCount").html(`(${n+1} of ${t.totalCount})`);$("div#eqMain h3").html(t.examName);$("div#eqMain h4").html(`${i.code||n+1}: ${i.statement}`);let e=u.find(n=>n.questionId===f),r="<div style='padding: 5px;' id='eqOption'>";for(let n in i.choices){let t=i.choices[n],u=t.id==(e?.choiceId??0);r+=`<label><input class='w3-radio' type='radio' name='option' value='${t.id}' ${u?"checked":""}> ${t.statement}</label><br/>`}r+="<\/div>";$("div#eqMain p").append(r);$("#eqMain button.w3-left").prop("disabled",n<=0);$("#eqMain button.w3-right").prop("disabled",n+1>=t.totalCount)}function b(n){o=null;$("#ddlExam").prop("disabled",!0);$("#btnStart").prop("disabled",!0);$("#btnSave").prop("disabled",!1);$.get("/api/Exam/",{ExamId:n},t=>{o=n,k(n),d(t.duration||0),nt()}).fail((n,t)=>{$("#ddlExam").prop("disabled",!1);$("#btnStart").prop("disabled",!1);$("#btnSave").prop("disabled",!0);let i=n.responseJSON||{error:"Server error",exception:n.responseText};i.exception&&console.error(i.exception|i.error);v(errorJsonm,t,n.status)})}function k(n){$.get("/api/Questions",{examId:n,isRecursive:!0,isRandom:!0,maxResultCount:50},n=>{t=n,a(0)}).fail(function(n,t){let i=n.responseJSON||{error:"Server error",exception:n.responseText};i.exception&&console.error(i.exception|i.error);v(i,t,n.status)})}function d(n){let i=new Date((new Date).getTime()+n*6e4);if(e.length==0){var t=setInterval(()=>{let r=(new Date).getTime(),n=i.getTime()-r,u=Math.floor(n%864e5/36e5),f=Math.floor(n%36e5/6e4),e=Math.floor(n%6e4/1e3);document.getElementById("timer").innerHTML="Time : "+u+":"+f+":"+e;n<0&&(clearInterval(t),document.getElementById("timer").innerHTML="Time : 00:00:00")},1e3);e.push(t)}}function g(){clearInterval(e[0]);e=[]}function nt(){var t;i==null?alert("Could not get local stream from mic/camera"):(l=[],console.log("Start recording..."),typeof MediaRecorder.isTypeSupported=="function"?(MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?t={mimeType:"video/webm;codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm;codecs=h264")?t={mimeType:"video/webm;codecs=h264"}:MediaRecorder.isTypeSupported("video/webm")?t={mimeType:"video/webm"}:MediaRecorder.isTypeSupported("video/mp4")&&(w="video/mp4",t={mimeType:"video/mp4"}),console.log("Using "+t.mimeType),n=new MediaRecorder(i,t)):(console.log("isTypeSupported is not supported, using default codecs for browser"),n=new MediaRecorder(i)),n.ondataavailable=function(n){console.log("mediaRecorder.ondataavailable, e.data.size="+n.data.size);n.data&&n.data.size>0&&l.push(n.data)},n.onerror=function(n){console.log("mediaRecorder.onerror: "+n)},n.onstart=function(){console.log("mediaRecorder.onstart, mediaRecorder.state = "+n.state);i.getTracks().forEach(function(n){n.kind=="audio"&&console.log("onstart - Audio track.readyState="+n.readyState+", track.muted="+n.muted);n.kind=="video"&&console.log("onstart - Video track.readyState="+n.readyState+", track.muted="+n.muted)})},n.onstop=function(){console.log("mediaRecorder.onstop, mediaRecorder.state = "+n.state);var t=new Blob(l,{type:n.mimeType});it(t)},n.onpause=function(){console.log("mediaRecorder.onpause, mediaRecorder.state = "+n.state)},n.onresume=function(){console.log("mediaRecorder.onresume, mediaRecorder.state = "+n.state)},n.onwarning=function(n){console.log("mediaRecorder.onwarning: "+n)},n.start(1e3),i.getTracks().forEach(function(n){console.log(n.kind+":"+JSON.stringify(n.getSettings()));console.log(n.getSettings())}))}function tt(){n.stop();c.srcObject=null}function it(n){var t=new FormData;t.append("video-blob",n);$.ajax({type:"POST",url:"/Home/SaveRecoredFile",data:t,cache:!1,contentType:!1,processData:!1,success:function(n){n&&console.log("Success")},error:function(n){console.log(n)}})}function v(n,t,i){$.alert({icon:"fa fa-error",type:"red",title:n?.error||"Error",content:"Error: "+t+" ("+n?.error+")<br/>Status: "+i,boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})}var o=null,t={},f=null,s=-1,u=[],h=null,y=null,r=null,e=[],rt=document.querySelector("button#btnStart"),ut=document.querySelector("button#btnSubmit"),c=document.querySelector("#gum");$("#ddlExam").prop("disabled",!1);$("#btnStart").prop("disabled",!1);$("#btnSubmit").prop("disabled",!1);$("#btnSave").prop("disabled",!0);$("#eqMain button.w3-left").prop("disabled",!0);$("#eqMain button.w3-right").prop("disabled",!0);$("#eqReport").children().prop("disabled",!0);$("#eqReport a").removeAttr("href");$("#eqReport i").addClass("w3-opacity-max");$("#eqScore").children().prop("disabled",!0);var n,l=[],i=null,p=null,w="video/webm";navigator.mediaDevices.getUserMedia?window.MediaRecorder==undefined?alert("MediaRecorder not supported on your browser, use the latest version of Firefox or Chrome"):navigator.mediaDevices.getUserMedia({audio:!0,video:{width:{min:640,ideal:640,max:640},height:{min:480,ideal:480,max:480},framerate:60}}).then(function(n){i=n;i.getTracks().forEach(function(n){n.kind=="audio"&&(n.onended=function(){console.log("audio track.onended Audio track.readyState="+n.readyState+", track.muted="+n.muted)});n.kind=="video"&&(n.onended=function(){log("video track.onended Audio track.readyState="+n.readyState+", track.muted="+n.muted)})});c.srcObject=i;c.play();try{window.AudioContext=window.AudioContext||window.webkitAudioContext;window.audioContext=new AudioContext}catch(t){console.log("Web Audio API not supported.")}p=window.soundMeter=new SoundMeter(window.audioContext);p.connectToSource(i,function(n){if(n){console.log(n);return}})}).catch(function(n){console.log("navigator.getUserMedia error: "+n)}):alert("navigator.mediaDevices.getUserMedia not supported on your browser, use the latest version of Firefox or Chrome");$.ajax({type:"GET",url:"/api/Exams",data:"{}",success:function(n){for(var i='<option value="">--- Please Select ---<\/option>',t=0;t<n.length;t++){let r=n[t],u=r.name.trim().substring(0,40);u.length<r.name.length&&(u=u.split(" ").slice(0,-1).join(" ")+"...");let f=!r.ancestorId?"":"&nbsp;&nbsp;";i+='<option value="'+r.id+'">'+f+u+"<\/option>"}$("#ddlExam").html(i)}});$("#btnStart").click(function(){$("#ddlExam").val()?b($("#ddlExam").val()):$.alert({icon:"fa fa-warning",type:"orange",title:"Select Skill",content:"Please select your skill !",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})});$("#btnPrev").click(function(){let n=(s-1)%t.totalCount;n<=t.totalCount-1&&($("#btnSave").click(),a(n))});$("#btnNext").click(function(){let n=(s+1)%t.totalCount;n<=t.totalCount-1&&($("#btnSave").click(),a(n))});$("#btnSave").click(function(){let n={candidateId:$("#eqCandidateId").text(),examId:o,questionId:f,choiceId:$('input[name="option"]:checked').val()||null};n.isCorrect=!!n.choiceId&&n.choiceId==t.questions.find(t=>t.id==n.questionId)?.correctChoiceId;let i=u.findIndex(n=>n.questionId===f);i>=0?u[i]=n:u.push(n)});$("#btnSubmit").click(function(){$.confirm({icon:"fa fa-warning",title:"Submit Quiz",content:"Are you sure you want to submit the quiz ?",type:"orange",closeIcon:!0,closeIconClass:"fa fa-close",boxWidth:"40%",useBootstrap:!1,buttons:{Submit:{text:"Submit",btnClass:"btn-red",action:function(){$("#btnSave").click();$.post("/api/Score/",{objRequest:u},function(n){n>0?(g(),tt(),$("#btnSubmit").prop("disabled",!0),$("#eqReport").children().prop("disabled",!1),$("#eqReport a").attr("href","/Score/Result"),$("#eqReport i").removeClass("w3-opacity-max"),$.alert({type:"green",title:"Success !",content:"Please check the score.",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})):($("#btnSubmit").prop("disabled",!1),$("#eqReport").children().prop("disabled",!0),$("#eqReport a").removeAttr("href"),$("#eqReport i").addClass("w3-opacity-max"),$.alert({type:"red",title:"Error !",content:"Please try again.",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"}))})}},Cancel:function(){$(this).remove()}}})});$(".btnScore").click(function(){var n={ExamId:$(this).closest("tr").find("td:eq(2)").text(),CandidateId:$("#hdnCandidateId").val(),SessionId:$(this).closest("tr").find("td:eq(1)").text()};h=$(this).closest("tr").find("td:eq(4)").text();y=$(this).closest("tr").find("td:eq(6)").text();$.post("/api/Report/",{argRpt:n},function(n){r=n;$("div#eqScore h3").html(n[0].exam+" Test");$("div#eqScore .w3-container p:eq(0)").html("<strong>Candidate ID:<\/strong> "+n[0].candidateID);$("div#eqScore .w3-container h5").html(n[0].message);$("div#eqScore .w3-container span").html("<strong>Date:<\/strong> "+n[0].date);y=="1"?$("#eqScore").children().prop("disabled",!1):(h=null,r=null,$("#eqScore").children().prop("disabled",!0))})});$("#btnReport").click(function(){var n={ExamId:r[0].examId,CandidateId:$("#hdnCandidateId").val(),SessionId:r[0].sessionID,Exam:r[0].exam,Date:r[0].date,Score:h};$.post("/api/CreatePDF/",{argPDFRpt:n},function(n){(n.isSuccess=!0)&&window.open(n.path,"_blank")})});$("#chooseFile").change(function(){var n=$("#chooseFile")[0].files[0].name;$("#noFile").text(n)})});